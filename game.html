<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ãƒ•ãƒ©ãƒƒã‚·ãƒ¥æ•°å­—è¨˜æ†¶ã‚²ãƒ¼ãƒ </title>

<style>
body {
  font-family: sans-serif;
  text-align: center;
}

#progress {
  font-size: 22px;
  color: #555;
  margin-top: 10px;
}

#display {
  font-size: 90px;
  margin: 10px;
  opacity: 1;
  transform: scale(1);
  transition: opacity 0.15s ease-out, transform 0.15s ease-out;
}

/* æ•°å­—ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ç”¨ */
.flash {
  opacity: 0;
  transform: scale(0.6);
}

.keypad button {
  width: 60px;
  height: 60px;
  font-size: 24px;
  margin: 5px;
}

.hidden {
  display: none;
}

.correct { color: green; }
.wrong { color: red; }

#result {
  font-size: 36px;
  margin-top: 15px;
}
</style>
</head>

<body>

<h1>ãƒ•ãƒ©ãƒƒã‚·ãƒ¥æ•°å­—è¨˜æ†¶ã‚²ãƒ¼ãƒ </h1>

<div>
  é€£ç¶šæ­£è§£å›æ•°ï¼š<span id="combo">0</span>
</div>

<br>

<select id="difficulty">
  <option value="easy">ä½</option>
  <option value="normal">ä¸­</option>
  <option value="hard">é«˜</option>
</select>

<br><br>

<button onclick="startGame()">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>

<div id="progress"></div>
<div id="display"></div>

<!-- å…¥åŠ›ã‚¨ãƒªã‚¢ -->
<div id="inputArea" class="hidden">
  <div class="keypad">
    <button onclick="inputNumber(1)">1</button>
    <button onclick="inputNumber(2)">2</button>
    <button onclick="inputNumber(3)">3</button><br>
    <button onclick="inputNumber(4)">4</button>
    <button onclick="inputNumber(5)">5</button>
    <button onclick="inputNumber(6)">6</button><br>
    <button onclick="inputNumber(7)">7</button>
    <button onclick="inputNumber(8)">8</button>
    <button onclick="inputNumber(9)">9</button>
  </div>
  <br>
  <button onclick="clearInput()">å–ã‚Šæ¶ˆã—</button>
</div>

<div id="result"></div>

<br>

<button id="retryBtn" class="hidden" onclick="retry()">ã‚‚ã†ä¸€åº¦</button>
<button id="endBtn" class="hidden" onclick="endGame()">çµ‚äº†</button>

<script>
let answer = [];
let userInput = [];
let combo = 0;

const display = document.getElementById("display");
const inputArea = document.getElementById("inputArea");
const result = document.getElementById("result");
const comboSpan = document.getElementById("combo");
const progress = document.getElementById("progress");

const timeTable = {
  easy: 1000,
  normal: 700,
  hard: 500
};

// ã‚²ãƒ¼ãƒ é–‹å§‹
function startGame() {
  answer = [];
  userInput = [];
  result.innerHTML = "";
  progress.textContent = "";
  inputArea.classList.add("hidden");
  display.textContent = "3";

  let count = 3;
  const countdown = setInterval(() => {
    count--;
    display.textContent = count > 0 ? count : "";
    if (count === 0) {
      clearInterval(countdown);
      showNumbers();
    }
  }, 1000);
}

// æ•°å­—è¡¨ç¤ºï¼ˆæ•°å­—ã®ã¿ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ï¼‰
function showNumbers() {
  const diff = document.getElementById("difficulty").value;
  const speed = timeTable[diff];

  answer = [];
  for (let i = 0; i < 5; i++) {
    answer.push(Math.floor(Math.random() * 9) + 1);
  }

  let index = 0;

  const timer = setInterval(() => {
    progress.textContent = `æ•°å­— ${index + 1} / 5`;

    // ãƒ•ãƒ©ãƒƒã‚·ãƒ¥é–‹å§‹ï¼ˆä¸€æ—¦æ¶ˆã™ï¼‰
    display.classList.add("flash");

    setTimeout(() => {
      display.textContent = answer[index];
      display.classList.remove("flash");
    }, 100);

    index++;

    if (index === answer.length) {
      clearInterval(timer);
      setTimeout(() => {
        display.textContent = "";
        progress.textContent = "";
        inputArea.classList.remove("hidden");
      }, speed);
    }
  }, speed);
}

// å…¥åŠ›
function inputNumber(num) {
  if (userInput.length >= 5) return;
  userInput.push(num);

  if (userInput.length === 5) {
    judge();
  }
}

// å…¥åŠ›å–ã‚Šæ¶ˆã—
function clearInput() {
  userInput = [];
}

// åˆ¤å®š
function judge() {
  inputArea.classList.add("hidden");

  let html = "";
  let isCorrect = true;

  answer.forEach((num, i) => {
    if (num === userInput[i]) {
      html += `<span class="correct">â—‹${num}</span> `;
    } else {
      html += `<span class="wrong">Ã—${num}</span> `;
      isCorrect = false;
    }
  });

  if (isCorrect) {
    combo++;
    result.innerHTML = "ğŸ‰ æ­£è§£ï¼ ğŸ‰<br>" + html;
  } else {
    combo = 0;
    result.innerHTML = "ğŸ’¥ ä¸æ­£è§£ ğŸ’¥<br>" + html;
  }

  comboSpan.textContent = combo;
  document.getElementById("retryBtn").classList.remove("hidden");
  document.getElementById("endBtn").classList.remove("hidden");
}

// å†æŒ‘æˆ¦
function retry() {
  document.getElementById("retryBtn").classList.add("hidden");
  document.getElementById("endBtn").classList.add("hidden");
  startGame();
}

// çµ‚äº†
function endGame() {
  display.textContent = "";
  progress.textContent = "";
  result.innerHTML = "";
  inputArea.classList.add("hidden");
  document.getElementById("retryBtn").classList.add("hidden");
  document.getElementById("endBtn").classList.add("hidden");
}
</script>

</body>
</html>
