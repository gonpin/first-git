<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ•ãƒ©ãƒƒã‚·ãƒ¥æ•°å­—è¨˜æ†¶ã‚²ãƒ¼ãƒ </title>
    <style>
        /* --- ãƒ‡ã‚¶ã‚¤ãƒ³è¨­å®š (CSS) --- */
        body {
            margin: 0;
            padding: 0;
            font-family: 'Helvetica Neue', Arial, sans-serif;
            /* èƒŒæ™¯ï¼šç´«ã€œé’ç³»ã®ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ */
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        /* ä¸­å¤®ã®ã‚«ãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ« */
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            text-align: center;
            width: 450px;
            min-height: 550px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        h1 { color: #333; margin-top: 0; }

        /* æ•°å­—è¡¨ç¤ºã‚¨ãƒªã‚¢ (ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ãƒ»ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³) */
        #display-area {
            font-size: 8em;
            font-weight: bold;
            height: 1.5em;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #444;
            margin: 20px 0;
        }

        /* æ•°å­—ãŒå‡ºã‚‹æ™‚ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        .pop-animation {
            animation: pop 0.3s ease-out;
        }
        @keyframes pop {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* 3x3ã®ã‚°ãƒªãƒƒãƒ‰ãƒœã‚¿ãƒ³ */
        .grid-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 20px auto;
            max-width: 250px;
        }

        .num-btn {
            width: 70px;
            height: 70px;
            font-size: 1.5rem;
            border: none;
            border-radius: 10px;
            background-color: #f0f0f0;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 0 #ccc;
        }

        .num-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 0 #ccc;
            background-color: #e0e0e0;
        }

        .num-btn:active:not(:disabled) {
            transform: translateY(2px);
            box-shadow: 0 2px 0 #ccc;
        }

        /* ãƒœã‚¿ãƒ³ç„¡åŠ¹åŒ–æ™‚ */
        .num-btn:disabled {
            background-color: #ddd;
            color: #aaa;
            cursor: not-allowed;
            box-shadow: none;
        }

        /* ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå…¥åŠ›ã—ãŸå±¥æ­´ */
        #input-history {
            font-size: 1.2rem;
            color: #666;
            margin-bottom: 10px;
            height: 1.5em;
        }

        /* çµæœè¡¨ç¤ºã®è‰² */
        .success { background-color: #d4edda; color: #155724 !important; border-radius: 10px; padding: 10px; }
        .failure { background-color: #f8d7da; color: #721c24 !important; border-radius: 10px; padding: 10px; }

        /* ä¸‹éƒ¨ã®ã‚¹ã‚³ã‚¢ã‚¨ãƒªã‚¢ */
        .stats {
            margin-top: 20px;
            font-size: 0.9rem;
            color: #555;
            border-top: 1px solid #eee;
            padding-top: 10px;
        }

        /* æ“ä½œç”¨ãƒœã‚¿ãƒ³ */
        .control-btn {
            padding: 10px 25px;
            font-size: 1rem;
            border: none;
            border-radius: 5px;
            background-color: #4CAF50;
            color: white;
            cursor: pointer;
            margin: 5px;
        }

        .control-btn:hover { opacity: 0.9; }
        .hidden { display: none; }
    </style>
</head>
<body>

<div class="container">
    <div id="setup-screen">
        <h1>ãƒ•ãƒ©ãƒƒã‚·ãƒ¥æ•°å­—</h1>
        <p>è¡¨ç¤ºã•ã‚Œã‚‹æ•°å­—ã®é †ç•ªã‚’è¦šãˆã¦ãã ã•ã„ï¼</p>
        <div style="margin: 20px 0;">
            é›£æ˜“åº¦ï¼š
            <select id="difficulty-select">
                <option value="easy">ç°¡å˜ (3å€‹)</option>
                <option value="normal" selected>æ™®é€š (5å€‹)</option>
                <option value="hard">é›£ã—ã„ (7å€‹)</option>
                <option value="extreme">è¶…é›£ã—ã„ (9å€‹)</option>
            </select>
        </div>
        <button class="control-btn" onclick="startGame()">ã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
    </div>

    <div id="game-screen" class="hidden">
        <div id="display-area"></div>
        <div id="input-history"></div>
        
        <div class="grid-container" id="button-grid">
            </div>

        <div id="result-area"></div>
        
        <div id="action-buttons" class="hidden">
            <button class="control-btn" onclick="startGame()">ã‚‚ã†ä¸€åº¦</button>
            <button class="control-btn" style="background-color: #999;" onclick="resetGame()">çµ‚äº†</button>
        </div>
    </div>

    <div class="stats">
        é€£ç¶šæˆåŠŸ: <span id="current-streak">0</span>å› | 
        æœ€é«˜è¨˜éŒ²: <span id="best-streak">0</span>å› | 
        æ­£è§£ç‡: <span id="win-rate">0</span>%
    </div>
</div>

<script>
    /* --- çŠ¶æ…‹ç®¡ç†ç”¨å¤‰æ•° --- */
    let correctSequence = []; // æ­£è§£ã®é †ç•ª
    let userSequence = [];    // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚¯ãƒªãƒƒã‚¯ã—ãŸé †ç•ª
    let currentStreak = 0;    // ç¾åœ¨ã®é€£ç¶šæˆåŠŸæ•°
    let maxStreak = 0;        // æœ€é«˜è¨˜éŒ²
    let totalGames = 0;       // ç·ãƒ—ãƒ¬ã‚¤å›æ•°
    let totalWins = 0;        // ç·æˆåŠŸå›æ•°

    // é›£æ˜“åº¦è¨­å®šãƒ‡ãƒ¼ã‚¿
    const difficultySettings = {
        easy: { count: 3, interval: 1000 },
        normal: { count: 5, interval: 700 },
        hard: { count: 7, interval: 500 },
        extreme: { count: 9, interval: 400 }
    };

    /**
     * ã‚²ãƒ¼ãƒ é–‹å§‹å‡¦ç†
     */
    function startGame() {
        // ç”»é¢åˆ‡ã‚Šæ›¿ãˆ
        document.getElementById('setup-screen').classList.add('hidden');
        document.getElementById('game-screen').classList.remove('hidden');
        document.getElementById('action-buttons').classList.add('hidden');
        document.getElementById('result-area').innerHTML = "";
        document.getElementById('input-history').innerText = "";
        
        // ã‚°ãƒªãƒƒãƒ‰ã‚’éš ã—ã¦ãƒªã‚»ãƒƒãƒˆ
        document.getElementById('button-grid').innerHTML = "";
        
        // é›£æ˜“åº¦å–å¾—
        const diffKey = document.getElementById('difficulty-select').value;
        const config = difficultySettings[diffKey];

        // æ­£è§£ã®æ•°å­—åˆ—ã‚’ä½œæˆ (1ã€œ9ã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ ã«é‡è¤‡ãªã—ã§æŠ½å‡º)
        generateSequence(config.count);

        // ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³é–‹å§‹
        startCountdown(() => {
            showNumberSequence(config.interval);
        });
    }

    /**
     * ãƒ©ãƒ³ãƒ€ãƒ ãªæ•°å­—ã®é…åˆ—ã‚’ä½œã‚‹
     */
    function generateSequence(count) {
        const numbers = [1, 2, 3, 4, 5, 6, 7, 8, 9];
        // é…åˆ—ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«ä¸¦ã³æ›¿ãˆã¦ã‹ã‚‰å¿…è¦ãªæ•°ã ã‘å–ã‚Šå‡ºã™
        const shuffled = numbers.sort(() => Math.random() - 0.5);
        correctSequence = shuffled.slice(0, count);
        userSequence = [];
    }

    /**
     * ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³è¡¨ç¤º (3, 2, 1)
     */
    function startCountdown(callback) {
        const display = document.getElementById('display-area');
        let count = 3;
        display.innerText = count;

        const timer = setInterval(() => {
            count--;
            if (count > 0) {
                display.innerText = count;
            } else {
                clearInterval(timer);
                display.innerText = "";
                callback(); // ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³çµ‚äº†å¾Œã«æ¬¡ã®å‡¦ç†ã¸
            }
        }, 1000);
    }

    /**
     * æ•°å­—ã‚’é †ç•ªã«ãƒ•ãƒ©ãƒƒã‚·ãƒ¥è¡¨ç¤º
     */
    function showNumberSequence(interval) {
        const display = document.getElementById('display-area');
        let index = 0;

        const timer = setInterval(() => {
            // æ•°å­—ã‚’è¡¨ç¤º
            display.innerText = correctSequence[index];
            display.classList.remove('pop-animation');
            void display.offsetWidth; // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å†ç™ºç«ã®ãŸã‚ã®ãƒãƒƒã‚¯
            display.classList.add('pop-animation');

            index++;

            // å…¨ã¦è¡¨ç¤ºã—çµ‚ã‚ã£ãŸã‚‰
            if (index > correctSequence.length) {
                clearInterval(timer);
                display.innerText = "ï¼Ÿ";
                createButtons(); // å…¥åŠ›ç”¨ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
            }
        }, interval);
    }

    /**
     * å…¥åŠ›ç”¨ãƒœã‚¿ãƒ³(3x3)ã‚’ä½œæˆ
     */
    function createButtons() {
        const grid = document.getElementById('button-grid');
        grid.innerHTML = ""; // åˆæœŸåŒ–

        for (let i = 1; i <= 9; i++) {
            const btn = document.createElement('button');
            btn.className = 'num-btn';
            btn.innerText = i;
            btn.onclick = () => selectNumber(i, btn);
            grid.appendChild(btn);
        }
    }

    /**
     * æ•°å­—ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸæ™‚ã®å‡¦ç†
     */
    function selectNumber(num, btn) {
        userSequence.push(num);
        btn.disabled = true; // äºŒåº¦æŠ¼ã—é˜²æ­¢

        // å…¥åŠ›å±¥æ­´ã‚’è¡¨ç¤º
        document.getElementById('input-history').innerText = userSequence.join(' â†’ ');

        // å¿…è¦ãªå€‹æ•°ã«é”ã—ãŸã‚‰åˆ¤å®š
        if (userSequence.length === correctSequence.length) {
            submitAnswer();
        }
    }

    /**
     * æ­£èª¤åˆ¤å®š
     */
    function submitAnswer() {
        totalGames++;
        const resultArea = document.getElementById('result-area');
        const display = document.getElementById('display-area');
        
        // é…åˆ—ã®ä¸­èº«ã‚’æ¯”è¼ƒ
        const isCorrect = JSON.stringify(correctSequence) === JSON.stringify(userSequence);

        if (isCorrect) {
            currentStreak++;
            totalWins++;
            if (currentStreak > maxStreak) maxStreak = currentStreak;
            
            display.innerText = "ğŸ‰";
            resultArea.innerHTML = `<div class="success"><h3>æ­£è§£ï¼</h3>æ­£è§£ã®é †ç•ª: ${correctSequence.join(', ')}</div>`;
        } else {
            currentStreak = 0;
            display.innerText = "âŒ";
            resultArea.innerHTML = `<div class="failure"><h3>æ®‹å¿µï¼</h3>æ­£è§£: ${correctSequence.join(', ')}<br>ã‚ãªãŸã®å›ç­”: ${userSequence.join(', ')}</div>`;
        }

        // ã‚¹ã‚³ã‚¢æ›´æ–°
        updateStats();

        // æ“ä½œãƒœã‚¿ãƒ³è¡¨ç¤º
        document.getElementById('action-buttons').classList.remove('hidden');
    }

    /**
     * ã‚¹ã‚³ã‚¢è¡¨ç¤ºã®æ›´æ–°
     */
    function updateStats() {
        document.getElementById('current-streak').innerText = currentStreak;
        document.getElementById('best-streak').innerText = maxStreak;
        const rate = totalGames === 0 ? 0 : Math.round((totalWins / totalGames) * 100);
        document.getElementById('win-rate').innerText = rate;
    }

    /**
     * æœ€åˆã®ç”»é¢ã«æˆ»ã‚‹
     */
    function resetGame() {
        document.getElementById('setup-screen').classList.remove('hidden');
        document.getElementById('game-screen').classList.add('hidden');
    }
</script>

</body>
</html>