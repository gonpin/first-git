<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ãƒã‚¹ã‚¿ãƒ¼</title>
    <style>
        /* --- ãƒ‡ã‚¶ã‚¤ãƒ³è¨­å®š (CSS) --- */
        body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            /* èƒŒæ™¯ã®ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆç´«ã€œé’ç³»ï¼‰ */
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: 'Helvetica Neue', Arial, sans-serif;
            color: #333;
        }

        .card {
            background-color: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            width: 90%;
            max-width: 600px;
            text-align: center;
        }

        h1 { color: #4a4a4a; margin-bottom: 1rem; }

        /* ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã¨ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        select, button, input {
            padding: 10px 15px;
            font-size: 1rem;
            border-radius: 5px;
            border: 1px solid #ccc;
            margin: 10px;
        }

        button {
            cursor: pointer;
            background-color: #667eea;
            color: white;
            border: none;
            transition: 0.3s;
        }

        button:hover { background-color: #5a6fd6; }

        /* ãŠé¡Œã¨åˆ¤å®šã®ã‚¨ãƒªã‚¢ */
        .display-area { margin: 20px 0; min-height: 120px; }
        
        .judgment-line { font-size: 1.5rem; height: 2rem; letter-spacing: 0.5rem; }
        .target-word { font-size: 2.5rem; font-weight: bold; letter-spacing: 0.5rem; margin: 10px 0; }
        
        .correct { color: #28a745; } /* ã€‡ã®è‰² */
        .incorrect { color: #dc3545; } /* Ã—ã®è‰² */

        /* å…¥åŠ›ã‚¨ãƒªã‚¢ */
        #user-input {
            width: 80%;
            font-size: 1.5rem;
            background-color: #f0f0f0;
            text-align: center;
            outline: none;
        }

        /* ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ã¨ãŠçŸ¥ã‚‰ã› */
        #timer { font-size: 1.2rem; font-weight: bold; color: #ff4757; }
        #message { font-size: 3rem; font-weight: bold; margin-top: 20px; }
        
        /* ãƒ™ã‚¹ãƒˆè¨˜éŒ²ã‚¨ãƒªã‚¢ */
        .ranking {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
            text-align: left;
        }

        /* éè¡¨ç¤ºã‚¯ãƒ©ã‚¹ */
        .hidden { display: none; }
    </style>
</head>
<body>

<div class="card">
    <h1>âŒ¨ï¸ ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã‚²ãƒ¼ãƒ </h1>

    <div id="setup-screen">
        <label for="difficulty">é›£æ˜“åº¦é¸æŠï¼š</label>
        <select id="difficulty">
            <option value="easy">ç°¡å˜ (5æ–‡å­—/20ç§’)</option>
            <option value="normal" selected>æ™®é€š (10æ–‡å­—/30ç§’)</option>
            <option value="hard">é›£ã—ã„ (15æ–‡å­—/30ç§’)</option>
            <option value="extra">æ¿€ãƒ ã‚º (20æ–‡å­—/30ç§’)</option>
        </select>
        <br>
        <button id="start-btn">ã‚²ãƒ¼ãƒ é–‹å§‹</button>
    </div>

    <div id="countdown-display" class="hidden" style="font-size: 5rem; font-weight: bold;"></div>

    <div id="game-screen" class="hidden">
        <div id="timer-display">æ®‹ã‚Šæ™‚é–“: <span id="timer">0</span>ç§’</div>
        
        <div class="display-area">
            <div id="judgment" class="judgment-line"></div>
            <div id="target" class="target-word"></div>
        </div>

        <input type="text" id="user-input" autocomplete="off" placeholder="ã“ã“ã«å…¥åŠ›ï¼">
        
        <div id="result-overlay">
            <div id="message"></div>
            <button id="retry-btn" class="hidden">å†æŒ‘æˆ¦</button>
            <button id="reset-btn">çµ‚äº†</button>
        </div>
    </div>

    <div class="ranking">
        <h3>ğŸ† ãƒ™ã‚¹ãƒˆè¨˜éŒ² (æ®‹ç§’æ•°)</h3>
        <ol id="best-list">
            <li>è¨˜éŒ²ãªã—</li>
            <li>è¨˜éŒ²ãªã—</li>
            <li>è¨˜éŒ²ãªã—</li>
        </ol>
        <div id="new-record" style="color: gold; font-weight: bold;"></div>
    </div>
</div>

<script>
    /* --- ãƒ­ã‚¸ãƒƒã‚¯è¨­å®š (JavaScript) --- */

    // ãŠé¡Œã®å˜èªãƒ‡ãƒ¼ã‚¿
    const words = {
        easy: ["apple", "bread", "cloud", "dance", "earth", "fruit", "glass", "heart"],
        normal: ["strawberry", "basketball", "experience", "everything", "government", "understand"],
        hard: ["congratulations", "advertisement", "communication", "infrastructure", "pronunciation"],
        extra: ["institutionalization", "intercontinental", "misunderstandings", "counterrevolution"]
    };

    // å¤‰æ•°ã®å®£è¨€
    let currentTarget = "";
    let timeLeft = 0;
    let timerInterval = null;
    let isGameActive = false;
    let bestScores = JSON.parse(localStorage.getItem('typingBestScores')) || [0, 0, 0];

    // HTMLè¦ç´ ã®å–å¾—
    const setupScreen = document.getElementById('setup-screen');
    const gameScreen = document.getElementById('game-screen');
    const countdownDisplay = document.getElementById('countdown-display');
    const targetDisplay = document.getElementById('target');
    const judgmentDisplay = document.getElementById('judgment');
    const userInput = document.getElementById('user-input');
    const timerText = document.getElementById('timer');
    const messageDisplay = document.getElementById('message');
    const bestList = document.getElementById('best-list');
    const newRecordMsg = document.getElementById('new-record');

    // åˆæœŸè¡¨ç¤ºã§ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚’æ›´æ–°
    updateRankingDisplay();

    // ã€ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã€‘ãŒæŠ¼ã•ã‚ŒãŸæ™‚
    document.getElementById('start-btn').addEventListener('click', () => {
        setupScreen.classList.add('hidden');
        startCountdown();
    });

    // ã€3ç§’ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³å‡¦ç†ã€‘
    function startCountdown() {
        countdownDisplay.classList.remove('hidden');
        let count = 3;
        countdownDisplay.textContent = count;

        const countInterval = setInterval(() => {
            count--;
            if (count > 0) {
                countdownDisplay.textContent = count;
            } else {
                clearInterval(countInterval);
                countdownDisplay.classList.add('hidden');
                initGame(); // ã‚²ãƒ¼ãƒ åˆæœŸåŒ–ã¸
            }
        }, 1000);
    }

    // ã€ã‚²ãƒ¼ãƒ ã®åˆæœŸåŒ–ã€‘
    function initGame() {
        gameScreen.classList.remove('hidden');
        userInput.value = "";
        userInput.focus();
        messageDisplay.textContent = "";
        newRecordMsg.textContent = "";
        document.getElementById('retry-btn').classList.add('hidden');
        document.body.style.backgroundColor = ""; // èƒŒæ™¯è‰²ãƒªã‚»ãƒƒãƒˆ

        // é›£æ˜“åº¦ã«å¿œã˜ãŸè¨­å®š
        const diff = document.getElementById('difficulty').value;
        const wordList = words[diff];
        currentTarget = wordList[Math.floor(Math.random() * wordList.length)];
        
        // åˆ¶é™æ™‚é–“ã®è¨­å®š
        timeLeft = (diff === 'easy') ? 20 : 30;
        timerText.textContent = timeLeft;

        // ç”»é¢ã«ãŠé¡Œã‚’è¡¨ç¤º
        targetDisplay.textContent = currentTarget;
        judgmentDisplay.textContent = "";
        
        isGameActive = true;
    }

    // ã€ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹å‡¦ç†ã€‘
    function startTimer() {
        if (timerInterval) return; // æ—¢ã«å‹•ã„ã¦ã„ã‚Œã°ä½•ã‚‚ã—ãªã„
        
        timerInterval = setInterval(() => {
            timeLeft--;
            timerText.textContent = timeLeft;

            if (timeLeft <= 0) {
                endGame(false); // å¤±æ•—
            }
        }, 1000);
    }

    // ã€å…¥åŠ›ãƒã‚§ãƒƒã‚¯å‡¦ç†ã€‘
    userInput.addEventListener('input', () => {
        if (!isGameActive) return;
        
        // æœ€åˆã®1æ–‡å­—ãŒå…¥åŠ›ã•ã‚ŒãŸã‚‰ã‚¿ã‚¤ãƒãƒ¼å§‹å‹•
        if (userInput.value.length === 1) {
            startTimer();
        }

        const userVal = userInput.value;
        let judgmentHTML = "";
        let allCorrect = true;

        // ãŠé¡Œã¨å…¥åŠ›ã‚’1æ–‡å­—ãšã¤æ¯”è¼ƒ
        for (let i = 0; i < currentTarget.length; i++) {
            if (i < userVal.length) {
                if (userVal[i] === currentTarget[i]) {
                    judgmentHTML += '<span class="correct">ã€‡</span>';
                } else {
                    judgmentHTML += '<span class="incorrect">Ã—</span>';
                    allCorrect = false;
                }
            } else {
                judgmentHTML += '<span>ã€€</span>'; // æœªå…¥åŠ›åˆ†
                allCorrect = false;
            }
        }
        judgmentDisplay.innerHTML = judgmentHTML;

        // å…¨æ–‡å­—æ­£è§£ã‹ã¤é•·ã•ãŒä¸€è‡´ã—ãŸå ´åˆ
        if (allCorrect && userVal.length === currentTarget.length) {
            endGame(true); // æˆåŠŸ
        }
    });

    // ã€ã‚²ãƒ¼ãƒ çµ‚äº†å‡¦ç†ã€‘
    function endGame(isSuccess) {
        isGameActive = false;
        clearInterval(timerInterval);
        timerInterval = null;
        userInput.disabled = true;
        document.getElementById('retry-btn').classList.remove('hidden');

        if (isSuccess) {
            let rankMsg = "";
            // æ®‹ã‚Šç§’æ•°ã«ã‚ˆã‚‹è©•ä¾¡
            if (timeLeft >= 6) rankMsg = "ç¥ï¼ ğŸ‘‘";
            else if (timeLeft >= 4) rankMsg = "ç´ æ™´ã‚‰ã—ã„ï¼ âœ¨";
            else if (timeLeft >= 2) rankMsg = "å¤§æˆåŠŸï¼ ğŸŒŸ";
            else rankMsg = "æˆåŠŸï¼ ğŸ‘";

            messageDisplay.textContent = rankMsg;
            messageDisplay.style.color = "#28a745";
            document.body.style.background = "#d4edda"; // æˆåŠŸæ™‚ã®ç·‘èƒŒæ™¯
            
            checkBestScore(timeLeft);
        } else {
            messageDisplay.textContent = "å¤±æ•—ãƒ»ãƒ»ãƒ» ğŸ˜¢";
            messageDisplay.style.color = "#dc3545";
            document.body.style.background = "#f8d7da"; // å¤±æ•—æ™‚ã®èµ¤èƒŒæ™¯
        }
    }

    // ã€ãƒ™ã‚¹ãƒˆã‚¹ã‚³ã‚¢åˆ¤å®šã€‘
    function checkBestScore(score) {
        // ãƒ™ã‚¹ãƒˆ3ã¨æ¯”è¼ƒï¼ˆé™é †ï¼šæ®‹ã‚Šç§’æ•°ãŒå¤šã„ã»ã†ãŒè‰¯ã„ï¼‰
        if (score > bestScores[2]) {
            bestScores.push(score);
            bestScores.sort((a, b) => b - a); // å¤§ãã„é †ã«ä¸¦ã¹æ›¿ãˆ
            bestScores = bestScores.slice(0, 3); // ä¸Šä½3ã¤ã‚’ä¿æŒ
            
            localStorage.setItem('typingBestScores', JSON.stringify(bestScores));
            newRecordMsg.textContent = "âœ¨ æ–°è¨˜éŒ²æ›´æ–°ï¼ âœ¨";
            updateRankingDisplay();
        }
    }

    // ã€ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ç¤ºæ›´æ–°ã€‘
    function updateRankingDisplay() {
        const listItems = bestList.querySelectorAll('li');
        bestScores.forEach((score, index) => {
            if (score > 0) {
                listItems[index].textContent = `${index + 1}ä½: ${score}ç§’æ®‹ã—`;
            }
        });
    }

    // ã€ãƒœã‚¿ãƒ³ç³»ã‚¤ãƒ™ãƒ³ãƒˆã€‘
    document.getElementById('retry-btn').addEventListener('click', () => {
        userInput.disabled = false;
        initGame();
    });

    document.getElementById('reset-btn').addEventListener('click', () => {
        location.reload(); // ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦æœ€åˆã«æˆ»ã‚‹
    });

</script>

</body>
</html>